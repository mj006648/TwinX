# ==============================================================================
# CloudNativePG 'cluster' Helm Chart Values (올바른 구조)
# ==============================================================================

# -- 클러스터의 기본 동작 모드
mode: standalone
# -- PostgreSQL 데이터베이스 타입
type: postgresql

# -- 사용할 PostgreSQL 메이저 버전
version:
  postgresql: "16"

cluster:
  # -- 클러스터의 인스턴스(Pod) 수
  instances: 1

  # -- PostgreSQL 클러스터의 초기 설정을 담당합니다. (Bootstrap)
  initdb:
    database: nessiedb
    owner: nessie_user
    secret:
      name: nessie-user-secret

  # -- 슈퍼유저(postgres)의 암호를 저장하고 관리할 Secret의 이름입니다.
  superuserSecret: "postgres-superuser-secret"

  # -- 데이터 영속성을 위한 스토리지 설정
  storage:
    size: 10Gi
    storageClass: "rook-ceph-block"

  # -- ★★★ 올바른 서비스 외부 노출 방식 설정 ★★★
  # managed.services를 사용하여 서비스를 선언적으로 관리합니다.
  managed:
    services:
      # -rw (read-write) 파드에 연결되는 추가 서비스를 정의합니다.
      additional:
        - selectorType: rw  # 'primary' 인스턴스를 타겟으로 지정합니다.
          serviceTemplate:
            metadata:
              # 생성될 서비스의 이름을 지정합니다. (기본 서비스 이름과 겹치지 않게)
              name: "nessiedb-loadbalancer"
            spec:
              # 서비스 타입을 LoadBalancer로 지정합니다.
              type: LoadBalancer
              ports:
                - name: postgres
                  port: 5432
                  targetPort: 5432
                  protocol: TCP

  # -- Pod의 리소스 요청량 및 최대 사용량 제한
  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "1"
      memory: "1Gi"

# -- 백업은 이 클러스터에서는 사용하지 않도록 비활성화합니다.
backups:
  enabled: false
