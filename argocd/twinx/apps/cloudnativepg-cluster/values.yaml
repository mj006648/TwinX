CNPG 헬름 차트의 values.yaml 구조 오류를 수정하고, 제시해주신 모든 설정을 반영한 최종 cloudnative-pg-cluster/values.yaml 전체 코드를 제공해 드립니다.

이 파일은 단일 인스턴스, LoadBalancer 서비스, 선언적 역할(Roles) 관리, 그리고 Nessie DB/User 생성을 CNPG 방식으로 완벽하게 구현합니다.

🛠️ 수정된 CNPG Cluster values.yaml 전체 코드
이 파일은 argocd/twinx/apps/cloudnativepg-cluster/values.yaml 경로에 사용될 것입니다.

핵심 변경 사항:

cluster.services: 배열([])에서 객체({}) 구조로 수정하여 ArgoCD 렌더링 오류(Invalid type. Expected: object, given: array)를 해결했습니다.

cluster.roles: nessie_prod_user를 선언적으로 생성하도록 추가했습니다.

cluster.enablePDB: 단일 인스턴스 구성을 위해 false로 설정했습니다.

YAML

# 파일 경로: argocd/twinx/apps/cloudnativepg-cluster/values.yaml

# -- Override the name of the chart
nameOverride: ""
# -- Override the full name of the chart
fullnameOverride: ""
# -- Override the namespace of the chart
namespaceOverride: ""

###
# -- Type of the CNPG database.
type: postgresql

version:
  # -- PostgreSQL major version to use
  postgresql: "16" 
  # -- If using TimescaleDB, specify the version (기본값 유지)
  timescaledb: "2.15"
  # -- If using PostGIS, specify the version (기본값 유지)
  postgis: "3.4"

###
# -- Cluster mode of operation.
mode: standalone

recovery: {} # 복구 모드 비활성화 (기본값 사용)


# -- 클러스터 기본 설정
cluster:
  # 단일 인스턴스 PostgreSQL 클러스터로 구성 (Bitnami standalone 및 readReplicas: false 대응)
  instances: 1

  # -- 데이터 영속성을 위한 PersistentVolumeClaim(PVC) 설정 (Bitnami persistence 대응)
  storage:
    size: 10Gi
    storageClass: "rook-ceph-block"

  # -- WAL 저장소를 별도로 사용하지 않도록 비활성화
  walStorage:
    enabled: false
    # size: 1Gi
    # storageClass: ""

  # -- Pod의 리소스 요청량 및 최대 사용량 제한 (Bitnami resources 대응)
  resources:
    limits:
      cpu: "1"
      memory: "1Gi"
    requests:
      cpu: "250m"
      memory: "512Mi"

  # -- Superuser 비밀번호 관리 활성화 (CNPG Operator가 Secret 자동 생성)
  enableSuperuserAccess: true
  superuserSecret: "" 

  # -- 서비스 외부 노출 방식 설정: LoadBalancer (오류 수정 완료)
  # CNPG 차트는 이 필드를 '객체'로 기대하며, 각 서비스는 내부 키로 정의됩니다.
  services:
    # Primary (read-write) 서비스 설정: LoadBalancer 타입 적용
    primary:
      type: LoadBalancer
    # Read-Only 서비스는 단일 인스턴스이므로 기본값(ClusterIP)을 유지하거나 제거할 수 있습니다.
    # replica: {} # 주석 처리하면 기본 ClusterIP가 생성됨

  # -- Pod Disruption Budget (PDB) 비활성화 (단일 인스턴스 업그레이드 편의성)
  enablePDB: false

  # -- Nessie 프로덕션 사용자 선언적으로 생성 (4단계 SQL 실행을 위해 필요)
  roles:
    - name: nessie_prod_user
      ensure: present
      login: true
      superuser: false

  # -- Nessie 카탈로그용 데이터베이스 및 사용자 생성 설정 (Bitnami auth 대응)
  initdb:
    # Nessie 카탈로그용으로 자동 생성할 데이터베이스 이름
    database: nessiedb
    # 위 데이터베이스에 접근할 사용자 이름 (Owner)
    owner: nessie_user 
    # Owner의 비밀번호를 담을 Secret 이름. 비워두면 Operator가 자동으로 생성합니다.
    secret: ""

# -- 백업 설정 (기존 Bitnami 설정에 없으므로 비활성화)
backups:
  enabled: false

# -- PgBouncer는 기존 설정에 없으므로 비활성화 유지
poolers: []
